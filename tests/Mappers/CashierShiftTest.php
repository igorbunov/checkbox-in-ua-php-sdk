<?php

declare(strict_types=1);

namespace igorbunov\Checkbox\Mappers;

use igorbunov\Checkbox\Mappers\Shifts\ShiftMapper;
use PHPUnit\Framework\TestCase;

class CashierShiftTest extends TestCase
{
    /** @var  string $jsonString */
    private $jsonString;

    /** @var  string $jsonString */
    private $jsonStringGetShift;

    public function setUp(): void
    {
        parent::setUp(); // TODO: Change the autogenerated stub

        $this->jsonString = '{
           "id":"53b2f4d7-7644-4cfb-8989-8348bc4a94b3",
           "serial":27,
           "status":"OPENED",
           "z_report":null,
           "opened_at":"2020-11-06T10:27:16.534707+00:00",
           "closed_at":null,
           "initial_transaction":{
              "id":"e9fd6539-19e0-4795-8be4-3a328ab85930",
              "type":"SHIFT_OPEN",
              "serial":0,
              "status":"DONE",
              "request_signed_at":"2020-11-06T10:27:15.498474+00:00",
              "request_received_at":null,
              "response_status":null,
              "response_error_message":null,
              "created_at":"2020-11-06T10:27:14.143355+00:00",
              "updated_at":"2020-11-06T10:27:16.527467+00:00"
           },
           "closing_transaction":null,
           "created_at":"2020-11-06T10:27:14.143355+00:00",
           "updated_at":"2020-11-06T10:27:16.534707+00:00",
           "balance":{
              "initial":247230,
              "balance":271230,
              "cash_sales":18900,
              "card_sales":13100,
              "cash_returns":0,
              "card_returns":0,
              "service_in":5100,
              "service_out":0,
              "updated_at":"2020-11-06T10:42:28.596707+00:00"
           },
           "taxes":[
              {
                 "id":"39b0ee46-e089-4b22-9d34-e14411b3ebff",
                 "code":1234567891,
                 "label":"Побори",
                 "symbol":"Я",
                 "rate":12,
                 "extra_rate":15,
                 "included":true,
                 "created_at":"2020-10-22T15:42:36+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"0fd01a27-fab1-45da-8234-9f968d8cf896",
                 "code":1234567890,
                 "label":"ПДВ",
                 "symbol":"A",
                 "rate":5,
                 "extra_rate":null,
                 "included":true,
                 "created_at":"2020-10-07T11:22:07+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"0360ebee-9db5-4d79-9e7d-9a77347aac55",
                 "code":123123,
                 "label":"4",
                 "symbol":"Д",
                 "rate":5,
                 "extra_rate":null,
                 "included":true,
                 "created_at":"2020-10-22T16:14:11+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"bdf5fcb0-19e4-43af-afe6-067ca071b346",
                 "code":4,
                 "label":"ПДВ",
                 "symbol":"В",
                 "rate":7,
                 "extra_rate":0,
                 "included":true,
                 "created_at":"2020-10-26T10:53:33+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"0f719ec3-4e6d-4842-a6d9-29522f704b94",
                 "code":2,
                 "label":"Акцизний збір",
                 "symbol":"Г",
                 "rate":0,
                 "extra_rate":5,
                 "included":true,
                 "created_at":"2020-10-26T10:53:41+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"35daba0c-9b88-4385-932f-b783c230e6f1",
                 "code":3,
                 "label":"Без ПДВ",
                 "symbol":"Е",
                 "rate":0,
                 "extra_rate":0,
                 "included":true,
                 "created_at":"2020-10-26T10:54:08+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"d70af868-1bac-43ed-b056-3e7870a60759",
                 "code":1,
                 "label":"ПДВ А",
                 "symbol":"Є",
                 "rate":20,
                 "extra_rate":0,
                 "included":true,
                 "created_at":"2020-10-26T10:54:18+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"cb2b0e92-1129-4921-bc86-49c124458931",
                 "code":5,
                 "label":"Не є об\'єктом оподаткування",
                 "symbol":"И",
                 "rate":0,
                 "extra_rate":0,
                 "included":true,
                 "created_at":"2020-10-26T10:54:47+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"ec54733c-19e5-4921-84c8-fbb805b05afd",
                 "code":1230321,
                 "label":"Без ПДВ",
                 "symbol":"Б",
                 "rate":0,
                 "extra_rate":3,
                 "included":true,
                 "created_at":"2020-10-08T16:22:21+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"8eaaf64f-c981-4cd9-8814-02328ca56034",
                 "code":123124,
                 "label":"1",
                 "symbol":"Ж",
                 "rate":1,
                 "extra_rate":1,
                 "included":true,
                 "created_at":"2020-10-08T16:24:47+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"095f9a81-6af3-4f74-9c9d-d2e8ad7c04e3",
                 "code":33333,
                 "label":"2",
                 "symbol":"З",
                 "rate":1,
                 "extra_rate":6,
                 "included":true,
                 "created_at":"2020-10-08T16:25:03+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              }
           ],
           "cash_register":{
              "id":"3e650f3e-09b9-44e4-baea-f40f143cbb00",
              "fiscal_number":"4000037367",
              "created_at":"2020-09-28T10:57:51+00:00",
              "updated_at":"2020-10-13T11:28:38+00:00"
           }
        }';

        $this->jsonStringGetShift = '{
           "id":"d05ceab6-772f-42c2-9cba-4394ba95de75",
           "serial":23,
           "status":"CLOSED",
           "z_report":{
              "id":"8a2462be-5af2-42a4-b475-4b39780ebd2d",
              "serial":23,
              "is_z_report":true,
              "payments":[
                 {
                    "id":"d3b65c55-45b4-4677-af4c-5b9b5e205d88",
                    "type":"CARD",
                    "label":"beznalichka",
                    "sell_sum":5900,
                    "return_sum":0,
                    "service_in":0,
                    "service_out":0
                 },
                 {
                    "id":"67e7fce6-2b2c-4637-a87f-8fbb4546d630",
                    "type":"CASH",
                    "label":"nalichka",
                    "sell_sum":17500,
                    "return_sum":0,
                    "service_in":0,
                    "service_out":0
                 },
                 {
                    "id":"20b25708-cee6-4b11-b01b-4606e0f51955",
                    "type":"CARD",
                    "label":"Безготівковий",
                    "sell_sum":43500,
                    "return_sum":0,
                    "service_in":1000,
                    "service_out":1000
                 },
                 {
                    "id":"7f503567-f977-4a06-aa0a-42308132bcc2",
                    "type":"CASH",
                    "label":"Готівкою",
                    "sell_sum":47400,
                    "return_sum":0,
                    "service_in":5100,
                    "service_out":0
                 }
              ],
              "taxes":[
                 {
                    "id":"bd9ceb7c-a191-424f-9ed0-10c07a02157e",
                    "code":1234567891,
                    "label":"Побори",
                    "symbol":"Я",
                    "rate":12.0,
                    "sell_sum":0,
                    "return_sum":0,
                    "sales_turnover":0,
                    "returns_turnover":0,
                    "created_at":"2020-10-22T15:42:36+00:00"
                 },
                 {
                    "id":"b68269ab-a120-4d19-9de7-694f5015b93c",
                    "code":1234567890,
                    "label":"ПДВ",
                    "symbol":"A",
                    "rate":5.0,
                    "sell_sum":0,
                    "return_sum":0,
                    "sales_turnover":0,
                    "returns_turnover":0,
                    "created_at":"2020-10-07T11:22:07+00:00"
                 },
                 {
                    "id":"85124029-5c85-4f94-b672-e272f49ba0b8",
                    "code":123123,
                    "label":"4",
                    "symbol":"Д",
                    "rate":5.0,
                    "sell_sum":0,
                    "return_sum":0,
                    "sales_turnover":0,
                    "returns_turnover":0,
                    "created_at":"2020-10-22T16:14:11+00:00"
                 },
                 {
                    "id":"d8cf6010-1754-49a1-8466-5db275d6e822",
                    "code":4,
                    "label":"ПДВ",
                    "symbol":"В",
                    "rate":7.0,
                    "sell_sum":0,
                    "return_sum":0,
                    "sales_turnover":0,
                    "returns_turnover":0,
                    "created_at":"2020-10-26T10:53:33+00:00"
                 },
                 {
                    "id":"90f99412-9a53-4a9d-b240-5c35781faf9f",
                    "code":2,
                    "label":"Акцизний збір",
                    "symbol":"Г",
                    "rate":0.0,
                    "sell_sum":0,
                    "return_sum":0,
                    "sales_turnover":0,
                    "returns_turnover":0,
                    "created_at":"2020-10-26T10:53:41+00:00"
                 },
                 {
                    "id":"5f52e751-8c66-4be2-9c88-ab956d8cc405",
                    "code":3,
                    "label":"Без ПДВ",
                    "symbol":"Е",
                    "rate":0.0,
                    "sell_sum":0,
                    "return_sum":0,
                    "sales_turnover":0,
                    "returns_turnover":0,
                    "created_at":"2020-10-26T10:54:08+00:00"
                 },
                 {
                    "id":"5775280d-28f4-4b66-b5fe-fc321c3881b0",
                    "code":1,
                    "label":"ПДВ А",
                    "symbol":"Є",
                    "rate":20.0,
                    "sell_sum":0,
                    "return_sum":0,
                    "sales_turnover":0,
                    "returns_turnover":0,
                    "created_at":"2020-10-26T10:54:18+00:00"
                 },
                 {
                    "id":"92ca1f96-d865-4eb1-bd02-0760da2ecb1e",
                    "code":5,
                    "label":"Не є об\'єктом оподаткування",
                    "symbol":"И",
                    "rate":0.0,
                    "sell_sum":0,
                    "return_sum":0,
                    "sales_turnover":0,
                    "returns_turnover":0,
                    "created_at":"2020-10-26T10:54:47+00:00"
                 },
                 {
                    "id":"6bdd8ada-c645-4006-b909-d9722dc90385",
                    "code":1230321,
                    "label":"Без ПДВ",
                    "symbol":"Б",
                    "rate":0.0,
                    "sell_sum":0,
                    "return_sum":0,
                    "sales_turnover":0,
                    "returns_turnover":0,
                    "created_at":"2020-10-08T16:22:21+00:00"
                 },
                 {
                    "id":"ac3f535f-5c09-452a-b925-f81bec3c7ac7",
                    "code":123124,
                    "label":"1",
                    "symbol":"Ж",
                    "rate":1.0,
                    "sell_sum":0,
                    "return_sum":0,
                    "sales_turnover":0,
                    "returns_turnover":0,
                    "created_at":"2020-10-08T16:24:47+00:00"
                 },
                 {
                    "id":"c0c191c2-113d-4b01-a34f-7e5cc58a650b",
                    "code":33333,
                    "label":"2",
                    "symbol":"З",
                    "rate":1.0,
                    "sell_sum":0,
                    "return_sum":0,
                    "sales_turnover":0,
                    "returns_turnover":0,
                    "created_at":"2020-10-08T16:25:03+00:00"
                 }
              ],
              "sell_receipts_count":14,
              "return_receipts_count":0,
              "transfers_count":0,
              "transfers_sum":0,
              "created_at":"2020-11-05T11:26:10.625628+00:00",
              "updated_at":"2020-11-05T11:26:10.773342+00:00"
           },
           "opened_at":"2020-11-04T13:31:44.569790+00:00",
           "closed_at":"2020-11-05T11:26:12.739024+00:00",
           "initial_transaction":{
              "id":"b6edab5c-de4d-4775-b096-1a4d2bd04ab8",
              "type":"SHIFT_OPEN",
              "serial":0,
              "status":"DONE",
              "request_signed_at":"2020-11-04T13:31:43.531479+00:00",
              "request_received_at":null,
              "response_status":null,
              "response_error_message":null,
              "created_at":"2020-11-04T13:31:42.649939+00:00",
              "updated_at":"2020-11-04T13:31:44.563521+00:00"
           },
           "closing_transaction":{
              "id":"d314da8e-2a9a-475e-9e17-79b98538fd40",
              "type":"Z_REPORT",
              "serial":4,
              "status":"DONE",
              "request_signed_at":"2020-11-05T11:26:11.689162+00:00",
              "request_received_at":null,
              "response_status":null,
              "response_error_message":null,
              "created_at":"2020-11-05T11:26:10.625628+00:00",
              "updated_at":"2020-11-05T11:26:12.733655+00:00"
           },
           "created_at":"2020-11-04T13:31:42.649939+00:00",
           "updated_at":"2020-11-05T11:26:12.759301+00:00",
           "balance":{
              "initial":167230,
              "balance":237230,
              "cash_sales":64900,
              "card_sales":49400,
              "cash_returns":0,
              "card_returns":0,
              "service_in":5100,
              "service_out":0,
              "updated_at":"2020-11-05T10:57:30.194832+00:00"
           },
           "taxes":[
              {
                 "id":"7615cde9-fb76-469a-b980-5e1e56344f28",
                 "code":1234567891,
                 "label":"Побори",
                 "symbol":"Я",
                 "rate":12,
                 "extra_rate":15,
                 "included":true,
                 "created_at":"2020-10-22T15:42:36+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"64724ec1-9eae-42fe-b589-1a5f877c28a9",
                 "code":1234567890,
                 "label":"ПДВ",
                 "symbol":"A",
                 "rate":5,
                 "extra_rate":null,
                 "included":true,
                 "created_at":"2020-10-07T11:22:07+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"6a746b69-df30-4fff-bcc5-5e5aca6c864a",
                 "code":123123,
                 "label":"4",
                 "symbol":"Д",
                 "rate":5,
                 "extra_rate":null,
                 "included":true,
                 "created_at":"2020-10-22T16:14:11+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"8e48783e-a1aa-45ea-b9db-a8e6ac461d8a",
                 "code":4,
                 "label":"ПДВ",
                 "symbol":"В",
                 "rate":7,
                 "extra_rate":0,
                 "included":true,
                 "created_at":"2020-10-26T10:53:33+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"0c9a6cb6-8071-430e-bbb1-91707dc90d74",
                 "code":2,
                 "label":"Акцизний збір",
                 "symbol":"Г",
                 "rate":0,
                 "extra_rate":5,
                 "included":true,
                 "created_at":"2020-10-26T10:53:41+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"f843866f-ae05-4ed5-ae77-b902f6da6a73",
                 "code":3,
                 "label":"Без ПДВ",
                 "symbol":"Е",
                 "rate":0,
                 "extra_rate":0,
                 "included":true,
                 "created_at":"2020-10-26T10:54:08+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"c8c3a5b7-71f3-4a68-9bc2-d9abb220710f",
                 "code":1,
                 "label":"ПДВ А",
                 "symbol":"Є",
                 "rate":20,
                 "extra_rate":0,
                 "included":true,
                 "created_at":"2020-10-26T10:54:18+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"e0accb26-9c7e-492c-9a59-79c04b68e5b6",
                 "code":5,
                 "label":"Не є об\'єктом оподаткування",
                 "symbol":"И",
                 "rate":0,
                 "extra_rate":0,
                 "included":true,
                 "created_at":"2020-10-26T10:54:47+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"3ee65863-550b-497d-96b9-168f7b61cfbb",
                 "code":1230321,
                 "label":"Без ПДВ",
                 "symbol":"Б",
                 "rate":0,
                 "extra_rate":3,
                 "included":true,
                 "created_at":"2020-10-08T16:22:21+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"9cce858f-0a82-4ee7-8ca4-b74712035922",
                 "code":123124,
                 "label":"1",
                 "symbol":"Ж",
                 "rate":1,
                 "extra_rate":1,
                 "included":true,
                 "created_at":"2020-10-08T16:24:47+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              },
              {
                 "id":"28cce046-c08f-4610-972f-1621bea630c6",
                 "code":33333,
                 "label":"2",
                 "symbol":"З",
                 "rate":1,
                 "extra_rate":6,
                 "included":true,
                 "created_at":"2020-10-08T16:25:03+00:00",
                 "updated_at":null,
                 "sales":0,
                 "returns":0,
                 "sales_turnover":0,
                 "returns_turnover":0
              }
           ],
           "cash_register":{
              "id":"3e650f3e-09b9-44e4-baea-f40f143cbb00",
              "fiscal_number":"4000037367",
              "created_at":"2020-09-28T10:57:51+00:00",
              "updated_at":"2020-10-13T11:28:38+00:00"
           },
           "cashier":{
              "id":"b24a5d01-9660-4269-baf9-ffda938c8f56",
              "full_name":"usertestkey 82",
              "nin":"",
              "key_id":"f8d4d9a394699c44616a8d84250f2cdc08331007d915f652e436b94e067643ed",
              "signature_type":"AGENT",
              "created_at":"2020-09-29T11:38:55+00:00",
              "updated_at":"2020-09-29T11:52:36+00:00"
           }
        }';
    }

    public function testMapShiftWithNull(): void
    {
        $this->assertNull(
            (new ShiftMapper())->jsonToObject(null)
        );
    }

    public function testMapShiftWithJson(): void
    {
        $jsonResponse = json_decode($this->jsonString, true);

        $mapped = (new ShiftMapper())->jsonToObject($jsonResponse);

        $this->assertEquals(
            '53b2f4d7-7644-4cfb-8989-8348bc4a94b3',
            $mapped->id
        );

        $this->assertEquals(
            'e9fd6539-19e0-4795-8be4-3a328ab85930',
            $mapped->initial_transaction->id
        );

        $this->assertEquals(
            '247230',
            $mapped->balance->initial
        );

        $this->assertEquals(
            '0fd01a27-fab1-45da-8234-9f968d8cf896',
            $mapped->taxes->taxes[1]->id
        );
    }

    public function testMapGetShiftWithJson(): void
    {
        $jsonResponse = json_decode($this->jsonStringGetShift, true);

        $mapped = (new ShiftMapper())->jsonToObject($jsonResponse);

        $this->assertEquals(
            'd05ceab6-772f-42c2-9cba-4394ba95de75',
            $mapped->id
        );

        $this->assertEquals(
            'b6edab5c-de4d-4775-b096-1a4d2bd04ab8',
            $mapped->initial_transaction->id
        );

        $this->assertEquals(
            '167230',
            $mapped->balance->initial
        );

        $this->assertEquals(
            '64724ec1-9eae-42fe-b589-1a5f877c28a9',
            $mapped->taxes->taxes[1]->id
        );

        $this->assertEquals(
            '8a2462be-5af2-42a4-b475-4b39780ebd2d',
            $mapped->z_report->id
        );

        $this->assertEquals(
            '67e7fce6-2b2c-4637-a87f-8fbb4546d630',
            $mapped->z_report->payments->payments[1]->id
        );
    }
}
